var background=(function(){"use strict";function c(r){return r==null||typeof r=="function"?{main:r}:r}const e=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome,d=c(()=>{e.runtime.onMessage.addListener((r,l,o)=>{if(r.type==="downloadImage"){const{url:n,savePath:t}=r;return console.log(`Background: 收到下载请求 ${t} (来自: ${n})`),e.downloads.download({url:n,filename:t,conflictAction:"overwrite"},a=>{if(e.runtime.lastError){const u=`下载失败: ${t} - ${e.runtime.lastError.message}`;console.error("Background:",u),o({success:!1,error:e.runtime.lastError.message,savePath:t})}else if(a===void 0){const u=`下载失败: ${t} - 未知错误 (downloadId is undefined)`;console.error("Background:",u),o({success:!1,error:"未知错误 (downloadId is undefined)",savePath:t})}else o({success:!0,downloadId:a,savePath:t})}),!0}return r.type==="getTid"?l.tab?.id?(e.scripting.executeScript({target:{tabId:l.tab.id},func:()=>window.tid},n=>{e.runtime.lastError?(console.error("获取TID失败:",e.runtime.lastError.message),o({error:e.runtime.lastError.message})):n&&n.length>0?o({tid:n[0].result}):o({tid:null})}),!0):(console.error("getTid 请求没有 sender.tab.id"),o({error:"No sender.tab.id"}),!1):(console.warn("未处理的消息类型:",r.type),!1)}),e.runtime.onInstalled.addListener(()=>{console.log("S1 Markdown Exporter 插件已安装。 (TS version)")})});function b(){}function i(r,...l){}const f={debug:(...r)=>i(console.debug,...r),log:(...r)=>i(console.log,...r),warn:(...r)=>i(console.warn,...r),error:(...r)=>i(console.error,...r)};let s;try{s=d.main(),s instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw f.error("The background crashed on startup!"),r}return s})();
